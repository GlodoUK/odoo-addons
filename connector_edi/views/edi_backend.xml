<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_edi_backend_kanban" model="ir.ui.view">
        <field name="name">view_edi_backend_kanban</field>
        <field name="model">edi.backend</field>
        <field name="arch" type="xml">
            <kanban class="oe_background_grey o_kanban_dashboard o_account_kanban">
                <field name="id" />
                <field name="name" />
                <field name="partner_id" />
                <field name="colour" />
                <field name="kanban_dashboard_graph" />
                <field name="message_count" />
                <field name="message_error_count" />
                <field name="message_pending_count" />
                <field name="message_done_count" />
                <field name="envelope_count" />
                <field name="show_kanban_dashboard_graph" />
                <field name="envelope_with_legacy_body_count" />
                <field name="message_with_legacy_body_count" />
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="#{kanban_color(record.colour.raw_value)}">
                            <div t-attf-class="o_kanban_card_header">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_primary">
                                        <a type="open"><field name="name" /></a>
                                    </div>
                                </div>
                                <div class="o_secondary" invisible="not partner_id">
                                    <field name="partner_id" />
                                </div>
                                <div class="o_kanban_manage_button_section">
                                    <a class="o_kanban_manage_toggle_button" href="#"><i
                                            class="fa fa-ellipsis-v"
                                            aria-label="Selection"
                                            role="img"
                                            title="Selection"
                                        /></a>
                                </div>
                            </div>
                            <div class="container o_kanban_card_content">
                                <div class="row">
                                    <div class="col-6 o_kanban_primary_left">
                                        <div class="row">
                                            <div class="col-12">
                                                <a
                                                    type="object"
                                                    name="action_view_envelopes"
                                                >
                                                    <field name="envelope_count" />
                                                    Envelopes
                                                </a>
                                            </div>

                                            <div
                                                class="col-12"
                                                invisible="envelope_pending_count &lt; 1"
                                            >
                                                <field name="envelope_pending_count" />
                                                Pending
                                            </div>
                                            <div
                                                class="col-12"
                                                invisible="envelope_error_count &lt; 1"
                                            >
                                                <a
                                                    class="text-danger font-weight-bold"
                                                    type="object"
                                                    name="action_view_envelopes"
                                                    context="{'search_default_error': 1}"
                                                >
                                                    <field
                                                        name="envelope_error_count"
                                                    />
                                                    with Error(s)
                                                </a>
                                            </div>
                                            <div
                                                class="col-12 text-warning"
                                                invisible="envelope_with_legacy_body_count == 0"
                                            >
                                                <i
                                                    class="fa fa-exclamation-triangle"
                                                    title="!"
                                                /> <field
                                                    name="envelope_with_legacy_body_count"
                                                /> with legacy body
                                            </div>
                                        </div>

                                    </div>
                                    <div
                                        class="col-6 o_kanban_primary_right text-right"
                                    >
                                        <div class="row">
                                            <div class="col-12">
                                                <a
                                                    name="action_view_messages"
                                                    type="object"
                                                >
                                                    <field name="message_count" />
                                                    Messages
                                                </a>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div
                                                class="col-12"
                                                invisible="message_pending_count &lt; 1"
                                            >
                                                <field name="message_pending_count" />
                                                Pending
                                            </div>
                                            <div
                                                class="col-12"
                                                invisible="message_pending_count &lt; 1"
                                            >
                                                <a
                                                    class="text-danger font-weight-bold"
                                                    type="object"
                                                    name="action_view_messages"
                                                    context="{'search_default_error': 1}"
                                                >
                                                    <field name="message_error_count" />
                                                    with Error(s)
                                                </a>
                                            </div>
                                            <div
                                                class="col-12 text-warning"
                                                invisible="message_with_legacy_body_count == 0"
                                            >
                                                <i
                                                    class="fa fa-exclamation-triangle"
                                                    title="!"
                                                /> <field
                                                    name="message_with_legacy_body_count"
                                                /> with legacy body
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <field
                                    name="kanban_dashboard_graph"
                                    graph_type="line"
                                    widget="dashboard_graph"
                                    invisible="not show_kanban_dashboard_graph"
                                />
                            </div>
                            <div
                                class="container o_kanban_card_manage_pane dropdown-menu"
                                role="menu"
                            >
                                <t t-call="BackendManage" />
                            </div>
                        </div>
                    </t>

                    <t t-name="BackendManage">

                        <div class="row">
                            <div
                                class="col-4 o_kanban_card_manage_section o_kanban_manage_view"
                            >
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">View</span>
                                </div>
                                <div>
                                    <a
                                        role="menuitem"
                                        type="object"
                                        name="action_view_envelopes"
                                    >Envelopes</a>
                                </div>
                                <div>
                                    <a
                                        role="menuitem"
                                        type="object"
                                        name="action_view_messages"
                                    >Messages</a>
                                </div>
                            </div>
                        </div>

                        <div
                            t-if="widget.editable"
                            class="o_kanban_card_manage_settings row"
                        >
                            <div class="col-8">
                                <ul class="oe_kanban_colorpicker" data-field="colour" />
                            </div>
                        </div>

                        <div class="row o_kanban_card_settings">
                            <div class="col-12 text-right">
                                <a t-if="widget.editable" type="edit">Settings</a>
                            </div>
                        </div>
                    </t>

                </templates>
            </kanban>
        </field>
    </record>
    <record id="view_edi_backend_form" model="ir.ui.view">
        <field name="name">view_edi_backend_form</field>
        <field name="model">edi.backend</field>
        <field name="arch" type="xml">
            <form string="EDI Backend">
                <header>
                    <button
                        name="action_migrate_legacy_body_to_attachment"
                        type="object"
                        string="Migrate to attachments"
                        confirm="This may take sometime and should not be run on a very large number of records"
                        invisible="message_with_legacy_body_count == 0 and envelope_with_legacy_body_count == 0"
                    />

                    <button
                        name="action_upload_file"
                        type="object"
                        string="Direct Upload"
                    />
                    <button name="action_sync_cron" type="object" string="Sync Cron" />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button
                            name="action_view_envelopes"
                            type="object"
                            icon="fa-envelope-o"
                            invisible="not envelope_message_routes_ok"
                        >
                        <field
                                name="envelope_count"
                                widget="statinfo"
                                string="Envelopes"
                            />
                    </button>

                    <button
                            name="action_view_messages"
                            type="object"
                            icon="fa-envelope-open-o"
                            invisible="not envelope_message_routes_ok"
                        >
                    <field name="message_count" widget="statinfo" string="Messages" />
                </button>

                <button
                            name="action_view_cron"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-clock-o"
                        ><span>Scheduled Actions</span>
                </button>
        </div>
        <label for="name" class="oe_edit_only" />
        <h1>
            <field name="name" class="oe_inline" />
        </h1>
        <div name="options">
            <span class="d-inline-block">
                <field name="envelope_message_routes_ok" />
                <label for="envelope_message_routes_ok" />
            </span>
        </div>
        <group>
            <group>
                <field name="envelope_with_legacy_body_count" invisible="1" />
                <field name="message_with_legacy_body_count" invisible="1" />
                <field name="partner_id" />
                <field name="partner_ref" />
            </group>
            <group>
                <field name="our_ref" />
            </group>
        </group>

        <div
                        class="alert alert-warning"
                        role="alert"
                        invisible="not warn_external_id_updateable"
                    >
            Editing through this editor is not advised. Upon next app upgrade some changes may be lost.
            <br />
            This configuration is defined through XML and is marked as updateable.
        </div>

        <notebook>
            <page
                            name="envelopes"
                            string="Envelope Routes"
                            invisible="not envelope_message_routes_ok"
                        >
                <field name="envelope_route_ids">
                <tree>
                    <field name="sequence" widget="handle" />
                    <field name="name" />
                    <field name="protocol" />
                    <field name="direction" />
                    <field
                                        name="protocol_in_trigger"
                                        invisible="direction not in ('both', 'in')"
                                    />
                    <field
                                        name="protocol_out_trigger"
                                        invisible="direction not in ('both', 'out')"
                                    />
                    <field name="codec" />
                    <field name="active" column_invisible="1" />
                </tree>
            </field>
            <p
                                class="text-muted"
                            >Envelope routes are used to describe how 1 or more messages is communicated to the relevant party. If messages are not batched, you can use the `Simple / Single Message` option.</p>
        </page>
        <page
                            name="routes"
                            string="Message Routes"
                            invisible="not envelope_message_routes_ok"
                        >
            <field name="message_route_ids">
            <tree decoration-muted="not active">
                <field name="sequence" widget="handle" />
                <field name="name" />
                <field name="direction" />
                <field name="action_trigger" />
                <field name="action" />
                <field name="active" column_invisible="1" />
            </tree>
        </field>
        <p
                                class="text-muted"
                            >Messages routes are used to describe how to handle messages.</p>
    </page>
    <page string="Document Mapping" name="mapping">
        <field name="mapping_ids">
            <tree editable="bottom">
                <field name="res_model_id" />
                <field name="res_id" />
                <field name="ref" />
                <field name="comment" />
            </tree>
        </field>
        <p
                                class="text-muted"
                            >TIP: Document mapping allows you to create a 1-1 mapping of terms between you and your partner. For example warehouses may have different codes. It is the responsibility of the relevant action to look up those values at this time.</p>
    </page>
    <page string="Secrets" name="secrets">
        <field name="secret_ids">
            <tree editable="bottom">
                <field name="key" />
                <field name="value" password="True" />
            </tree>
        </field>
        <p
                                class="text-muted"
                            >TIP: Secrets are automatically injected into any code as SECRET_KEY.</p>
    </page>
    <page string="Common Code" name="common_code">
        <field name="common_code" options="{'mode': 'python'}" widget="ace" />
        <p class="text-muted">
            TIP: A place for helpers and constants.
            You can add here any functions or variables, that don't start with underscore and then reuse it in any other code for this backend.
        </p>
    </page>
    <page string="Other Information" name="other_info">
        <group>
            <group name="display" string="Display Preferences">
                <field name="show_kanban_dashboard_graph" widget="boolean_toggle" />
                <field name="colour" widget="color_picker" />
            </group>
            <group name="followers" string="Followers">
                <field name="subscribe_group_ids" widget="many2many_tags" />
                <field name="subscribe_partner_ids" widget="many2many_tags" />
            </group>
            <group name="hints" string="Hints">
                <field name="hint_duplicates" />
                <field name="hint_trust_partner" />
            </group>
            <group name="technical" string="Technical">
                <field name="envelope_sequence" />
                <field name="message_sequence" />
                <field name="warn_external_id_updateable" />
            </group>
        </group>
    </page>
</notebook>
            </sheet>
        </form>
    </field>
</record>
<record id="view_edi_backend_search" model="ir.ui.view">
    <field name="name">view_edi_backend_search</field>
    <field name="model">edi.backend</field>
    <field name="arch" type="xml">
        <search>
            <field name="name" />
            <field name="partner_id" />
            <field name="envelope_route_ids" />
            <field name="message_route_ids" />
            <filter
                    name="archived"
                    domain="[('active', '=', False)]"
                    string="Archived"
                />
        </search>
    </field>
</record>
<record id="view_edi_backend_tree" model="ir.ui.view">
    <field name="name">view_edi_backend_tree</field>
    <field name="model">edi.backend</field>
    <field name="arch" type="xml">
        <tree>
            <field name="name" />
            <field name="partner_id" />
        </tree>
    </field>
</record>
<record id="action_edi_backend" model="ir.actions.act_window">
    <field name="name">EDI Backends</field>
    <field name="res_model">edi.backend</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="view_id" ref="view_edi_backend_kanban" />
</record>
</odoo>
